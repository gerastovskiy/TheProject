<source>
  @type forward
  port 24224
  bind 0.0.0.0
  <parse>
    @type json
    time_key time
    time_type string
    time_format %Y-%m-%dT%H:%M:%S.%NZ
  </parse>
</source>

<filter >
  @type record_transformer
  enable_ruby true
  <record>
    # Преобразуем время в правильный формат
    log_time ${time.strftime('%Y-%m-%dT%H:%M:%S.%3NZ')}
  </record>
</filter>

<match >
  @type elasticsearch
  host elasticsearch
  port 9200
  scheme http
  ssl_verify false
  logstash_format true
  logstash_prefix spring-logs
  include_timestamp true
  time_key log_time
  default_elasticsearch_version 8
  suppress_type_name true
  
  <buffer>
    @type memory
    flush_interval 5s
    chunk_limit_size 2M
    retry_max_times 5
  </buffer>
</match>

<match **>
  @type stdout  # Вывод логов в консоль Fluentd
</match>